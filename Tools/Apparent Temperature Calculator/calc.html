<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../../Data/global.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMTemperature Mod Calculator</title>
    <style>
        body {
            /* Your custom gradient mix looks great! */
            background: linear-gradient(rgba(7, 61, 20, 0.685), rgba(6, 27, 58, 0.678)), 
                    url('../../Data/minecraftbackground.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        /* We keep the container styling here as it's specific to this tool */
        .container {
            background: rgba(37, 37, 38, 0.8); /* Added transparency to match glass theme */
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            width: 350px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h2 { margin-top: 0; color: #fff; text-align: center; }
        label { display: block; margin-top: 15px; font-size: 0.85em; color: #00bcd4; font-weight: bold; }
        
        input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            box-sizing: border-box;
            background-color: rgba(60, 60, 60, 0.5);
            border: 1px solid #3e3e42;
            color: #fff;
            border-radius: 6px;
            outline: none;
        }
        input:focus { border-color: #00bcd4; }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(30, 30, 30, 0.6);
            border-radius: 8px;
            border-left: 5px solid #00bcd4;
        }
        .status { font-weight: bold; font-size: 1.2em; }
        .details { font-size: 0.85em; color: #aaa; margin-top: 5px; }
        
        /* Status Colors stay here as they are unique to this logic */
        .status-icy { color: #3b8eea; border-color: #3b8eea !important; }
        .status-cold { color: #8ec3eb; border-color: #8ec3eb !important; }
        .status-neutral { color: #69c568; border-color: #69c568 !important; }
        .status-warm { color: #eebb00; border-color: #eebb00 !important; }
        .status-hot { color: #ea4e3b; border-color: #ea4e3b !important; }
    </style>
</head>
<body>

    <a href="../../Home/home.html" class="home-nav-btn">go back to the streets</a>

    <div class="container">
        <h2>Weather Calculator</h2>
        
        <label>Air Temperature (°F)</label>
        <input type="number" id="tempF" value="79" oninput="updateInputStates()">

        <label id="labelDew">Dew Point (°F)</label>
        <input type="number" id="dewF" value="63">

        <label id="labelWind">Wind Speed (mph)</label>
        <input type="number" id="windMph" value="2">

        <div id="logicNote" style="color: #00bcd4; font-size: 0.8em; margin-top: 10px; font-style: italic; min-height: 2.5em;"></div>

        <button onclick="calculate()" class="glass-btn" style="width:100%">Calculate Status</button>

        <div id="result" class="result-box" style="display:none;">
           <div id="statusText" class="status">NEUTRAL</div>
           <div id="calcDetails" class="details"></div>
        </div>

        <button onclick="downloadThisPage()" class="glass-btn" style="width:100%; margin-top: 10px; border-color: #4CAF50; color: #4CAF50;">Download HTML</button>
    </div>

    <script>
        // --- CONFIGURATION (Match your Java Config) ---
        const CONFIG = {
            icy: 0.0,
            cold: 8.0,
            warm: 26.0,
            hot: 32.0
        };

        function updateInputStates() {
            const tempF = parseFloat(document.getElementById('tempF').value);
            const tempC = (tempF - 32) * (5/9);
    
            const dewInput = document.getElementById('dewF');
            const windInput = document.getElementById('windMph');
            const dewLabel = document.getElementById('labelDew');
            const windLabel = document.getElementById('labelWind');
            const note = document.getElementById('logicNote');

            if (tempC > 20) {
                // HEAT ZONE: Disable Wind
                dewInput.disabled = false;
                dewLabel.style.opacity = "1";
                windInput.disabled = true;
                windLabel.style.opacity = "0.4";
                note.innerText = "Wind speed is ignored above 68°F (20°C).";
            } else if (tempC < 10) {
                // COLD ZONE: Disable Humidity
                dewInput.disabled = true;
                dewLabel.style.opacity = "0.4";
                windInput.disabled = false;
                windLabel.style.opacity = "1";
                note.innerText = "Humidity is ignored below 50°F (10°C).";
            } else {
                // NEUTRAL ZONE: Disable both
                dewInput.disabled = true;
                dewLabel.style.opacity = "0.4";
                windInput.disabled = true;
                windLabel.style.opacity = "0.4";
                note.innerText = "Between 50°F and 68°F, wind and humidity have no effect.";
            }
        }   

    // Make sure it runs once as soon as the page loads
    window.onload = updateInputStates;

    function calculate() {
        // 1. Get Inputs
        let tempF = parseFloat(document.getElementById('tempF').value);
        let dewF = parseFloat(document.getElementById('dewF').value);
        let windMph = parseFloat(document.getElementById('windMph').value);

        if (isNaN(tempF) || isNaN(dewF) || isNaN(windMph)) {
            alert("Please enter valid numbers");
            return;
        }

        // 2. Convert to Metric (Internal Mod Units)
        let tempC = (tempF - 32) * (5/9);
        let dewC = (dewF - 32) * (5/9);
        let windMs = windMph * 0.44704;

        // 3. Run the Mod Logic (Apparent Temp)
        let apparentC = getApparentTemperature(tempC, dewC, windMs);
        let apparentF = (apparentC * 9/5) + 32;

        // 4. Determine Status
        let status = "NEUTRAL";
        let cssClass = "status-neutral";

        if (apparentC < CONFIG.icy) {
            status = "ICY";
            cssClass = "status-icy";
        } else if (apparentC < CONFIG.cold) {
            status = "COLD";
            cssClass = "status-cold";
        } else if (apparentC > CONFIG.hot) {
            status = "HOT";
            cssClass = "status-hot";
        } else if (apparentC > CONFIG.warm) {
            status = "WARM";
            cssClass = "status-warm";
        }

        // 5. Display
        let resultBox = document.getElementById('result');
        let statusText = document.getElementById('statusText');
        let details = document.getElementById('calcDetails');

        resultBox.style.display = "block";
        resultBox.className = "result-box " + cssClass; // Apply color border
        
        statusText.innerText = `Status: ${status}`;
        statusText.className = "status " + cssClass; // Apply color text

        let diff = apparentC - tempC;
        let explanation = "";
        if (Math.abs(diff) < 0.1) explanation = "Conditions are neutral.";
        else if (diff > 0) explanation = "Humidity is raising the heat index.";
        else explanation = "Wind is lowering the perceived temp.";

        details.innerHTML = `
            <strong>Real Temp:</strong> ${tempF.toFixed(1)}°F (${tempC.toFixed(1)}°C)<br>
            <strong>Apparent:</strong> ${apparentF.toFixed(1)}°F (${apparentC.toFixed(1)}°C)<br>
            <br>
            <em>${explanation}</em>
        `;
    }

    // Exact Logic from PMTemperature.java
    function getApparentTemperature(airTemp, dewPoint, windSpeed) {
        // Heat Index (Above 20C)
        if (airTemp > 20) {
            return airTemp + 0.5555 * (6.11 * Math.exp(5417.753 * (0.0036609921 - (1 / (273.15 + dewPoint)))) - 10);
        }
        // Wind Chill (Below 10C)
        if (airTemp < 10) {
            return 13.12 + 0.6215 * airTemp - 11.37 * Math.pow(windSpeed, 0.16);
        }
        return airTemp;
    }

    function downloadThisPage() {
    // Get the entire HTML content of the current page
    document.getElementById('result').style.display = "none";
    const htmlContent = document.documentElement.outerHTML;
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    
    // Create a hidden link and click it to trigger download
    const a = document.createElement('a');
    a.href = url;
    a.download = 'weather_calculator.html';
    document.body.appendChild(a);
    a.click();
    
    // Cleanup
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    }
</script>

</body>
</html>