<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMTemperature Mod Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(rgba(9, 83, 27, 0.589), rgba(7, 32, 70, 0.562)), 
                    url('../OtherFiles/minecraftbackground.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #d4d4d4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #252526;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            width: 350px;
            border: 1px solid #3e3e42;
        }
        h2 { margin-top: 0; color: #fff; text-align: center; }
        label { display: block; margin-top: 10px; font-size: 0.9em; color: #aaa; }
        input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
            background-color: #3c3c3c;
            border: 1px solid #3e3e42;
            color: #fff;
            border-radius: 4px;
        }
        button {
            width: 100%;
            margin-top: 20px;
            padding: 10px;
            background-color: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        button:hover { background-color: #1177bb; }
        
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: #1e1e1e;
            border-radius: 4px;
            border-left: 5px solid #555;
        }
        .status { font-weight: bold; font-size: 1.2em; }
        .details { font-size: 0.85em; color: #aaa; margin-top: 5px; }
        
        /* Status Colors */
        .status-icy { color: #3b8eea; border-color: #3b8eea; }
        .status-cold { color: #8ec3eb; border-color: #8ec3eb; }
        .status-neutral { color: #69c568; border-color: #69c568; }
        .status-warm { color: #eebb00; border-color: #eebb00; }
        .status-hot { color: #ea4e3b; border-color: #ea4e3b; }
    </style>
</head>
<body>

<div class="container">
    <h2>Apparent Temperature Calculator - PMTemperature</h2>
    
    <label>Air Temperature (°F)</label>
    <input type="number" id="tempF" value="79" placeholder="79" oninput="updateInputStates()">

    <label id="labelDew">Dew Point (°F)</label>
    <input type="number" id="dewF" value="63" placeholder="63">

    <label id="labelWind">Wind Speed (mph)</label>
    <input type="number" id="windMph" value="2" placeholder="2">

    <div id="logicNote" style="color: #00bcd4; font-size: 0.85em; margin-top: 10px; font-style: italic; min-height: 1.2em;"></div>

    <button onclick="calculate()">Calculate Status</button>

    <div id="result" class="result-box" style="display:none;">
        <div id="statusText" class="status">NEUTRAL</div>
        <div id="calcDetails" class="details"></div>
    </div>

    <button onclick="downloadThisPage()" style="background-color: #4CAF50; margin-top: 10px;">Download HTML File</button>
</div>

<script>
    // --- CONFIGURATION (Match your Java Config) ---
    const CONFIG = {
        icy: 0.0,
        cold: 8.0,
        warm: 26.0,
        hot: 32.0
    };

    function updateInputStates() {
        const tempF = parseFloat(document.getElementById('tempF').value);
        const tempC = (tempF - 32) * (5/9);
    
        const dewInput = document.getElementById('dewF');
        const windInput = document.getElementById('windMph');
        const dewLabel = document.getElementById('labelDew');
        const windLabel = document.getElementById('labelWind');
        const note = document.getElementById('logicNote');

        if (tempC > 20) {
            // HEAT ZONE: Disable Wind
            dewInput.disabled = false;
            dewLabel.style.opacity = "1";
            windInput.disabled = true;
            windLabel.style.opacity = "0.4";
            note.innerText = "Wind speed is ignored above 68°F (20°C).";
        } else if (tempC < 10) {
            // COLD ZONE: Disable Humidity
            dewInput.disabled = true;
            dewLabel.style.opacity = "0.4";
            windInput.disabled = false;
            windLabel.style.opacity = "1";
            note.innerText = "Humidity is ignored below 50°F (10°C).";
        } else {
            // NEUTRAL ZONE: Disable both
            dewInput.disabled = true;
            dewLabel.style.opacity = "0.4";
            windInput.disabled = true;
            windLabel.style.opacity = "0.4";
            note.innerText = "Between 50°F and 68°F, wind and humidity have no effect.";
        }
    }

    // Make sure it runs once as soon as the page loads
    window.onload = updateInputStates;

    function calculate() {
        // 1. Get Inputs
        let tempF = parseFloat(document.getElementById('tempF').value);
        let dewF = parseFloat(document.getElementById('dewF').value);
        let windMph = parseFloat(document.getElementById('windMph').value);

        if (isNaN(tempF) || isNaN(dewF) || isNaN(windMph)) {
            alert("Please enter valid numbers");
            return;
        }

        // 2. Convert to Metric (Internal Mod Units)
        let tempC = (tempF - 32) * (5/9);
        let dewC = (dewF - 32) * (5/9);
        let windMs = windMph * 0.44704;

        // 3. Run the Mod Logic (Apparent Temp)
        let apparentC = getApparentTemperature(tempC, dewC, windMs);
        let apparentF = (apparentC * 9/5) + 32;

        // 4. Determine Status
        let status = "NEUTRAL";
        let cssClass = "status-neutral";

        if (apparentC < CONFIG.icy) {
            status = "ICY";
            cssClass = "status-icy";
        } else if (apparentC < CONFIG.cold) {
            status = "COLD";
            cssClass = "status-cold";
        } else if (apparentC > CONFIG.hot) {
            status = "HOT";
            cssClass = "status-hot";
        } else if (apparentC > CONFIG.warm) {
            status = "WARM";
            cssClass = "status-warm";
        }

        // 5. Display
        let resultBox = document.getElementById('result');
        let statusText = document.getElementById('statusText');
        let details = document.getElementById('calcDetails');

        resultBox.style.display = "block";
        resultBox.className = "result-box " + cssClass; // Apply color border
        
        statusText.innerText = `Status: ${status}`;
        statusText.className = "status " + cssClass; // Apply color text

        let diff = apparentC - tempC;
        let explanation = "";
        if (Math.abs(diff) < 0.1) explanation = "Conditions are neutral.";
        else if (diff > 0) explanation = "Humidity is raising the heat index.";
        else explanation = "Wind is lowering the perceived temp.";

        details.innerHTML = `
            <strong>Real Temp:</strong> ${tempF.toFixed(1)}°F (${tempC.toFixed(1)}°C)<br>
            <strong>Apparent:</strong> ${apparentF.toFixed(1)}°F (${apparentC.toFixed(1)}°C)<br>
            <br>
            <em>${explanation}</em>
        `;
    }

    // Exact Logic from PMTemperature.java
    function getApparentTemperature(airTemp, dewPoint, windSpeed) {
        // Heat Index (Above 20C)
        if (airTemp > 20) {
            return airTemp + 0.5555 * (6.11 * Math.exp(5417.753 * (0.0036609921 - (1 / (273.15 + dewPoint)))) - 10);
        }
        // Wind Chill (Below 10C)
        if (airTemp < 10) {
            return 13.12 + 0.6215 * airTemp - 11.37 * Math.pow(windSpeed, 0.16);
        }
        return airTemp;
    }

    function downloadThisPage() {
    // Get the entire HTML content of the current page
    document.getElementById('result').style.display = "none";
    const htmlContent = document.documentElement.outerHTML;
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    
    // Create a hidden link and click it to trigger download
    const a = document.createElement('a');
    a.href = url;
    a.download = 'weather_calculator.html';
    document.body.appendChild(a);
    a.click();
    
    // Cleanup
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    }
</script>

</body>
</html>